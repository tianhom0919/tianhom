"use strict";(self.webpackChunkth_ws=self.webpackChunkth_ws||[]).push([[8364],{1490:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/E-2-2-27f6a40c42296686d3411e9b66f97550.png"},5472:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/E-2-0-bd4295d559a7b31f5aeeee67d7255f7b.png"},8453:(e,t,i)=>{i.d(t,{R:()=>s,x:()=>a});var r=i(6540);const n={},o=r.createContext(n);function s(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(o.Provider,{value:t},e.children)}},8567:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"my-tutorials/mcut-tutorials/week-2/E-2","title":"E-2 Applying OV5640 Driver Patch File to RZ/V2H","description":"This guide provides detailed steps for applying a patch to support the OV5640 camera module on the Renesas RZ/V2H platform.","source":"@site/docs/my-tutorials/mcut-tutorials/week-2/E-2.md","sourceDirName":"my-tutorials/mcut-tutorials/week-2","slug":"/my-tutorials/mcut-tutorials/week-2/E-2","permalink":"/tianhom/docs/my-tutorials/mcut-tutorials/week-2/E-2","draft":false,"unlisted":false,"editUrl":"https://github.com/tianhom0919/tianhom/tree/main/th-ws/docs/my-tutorials/mcut-tutorials/week-2/E-2.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"E-1 Applying OV5640 Driver Patch File to RZ/G2L","permalink":"/tianhom/docs/my-tutorials/mcut-tutorials/week-2/E-1"},"next":{"title":"Week 3: GStreamer","permalink":"/tianhom/docs/category/week-3-gstreamer"}}');var n=i(4848),o=i(8453);const s={sidebar_position:5},a="E-2 Applying OV5640 Driver Patch File to RZ/V2H",d={},c=[{value:"Step 1: Modify the Device Tree and Kernel Configuration",id:"step-1-modify-the-device-tree-and-kernel-configuration",level:2},{value:"Edit the Device Tree Source",id:"edit-the-device-tree-source",level:3},{value:"Update the Kernel Configuration",id:"update-the-kernel-configuration",level:3},{value:"Step 2: Create and Export the Patch",id:"step-2-create-and-export-the-patch",level:2},{value:"Step 3: Integrate Patch File Into Build",id:"step-3-integrate-patch-file-into-build",level:2},{value:"Step 4: Deploy the Image and Verify Camera Registration",id:"step-4-deploy-the-image-and-verify-camera-registration",level:2},{value:"Step 5: Configure Camera Preview Script",id:"step-5-configure-camera-preview-script",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"e-2-applying-ov5640-driver-patch-file-to-rzv2h",children:"E-2 Applying OV5640 Driver Patch File to RZ/V2H"})}),"\n",(0,n.jsx)(t.p,{children:"This guide provides detailed steps for applying a patch to support the OV5640 camera module on the Renesas RZ/V2H platform."}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"step-1-modify-the-device-tree-and-kernel-configuration",children:"Step 1: Modify the Device Tree and Kernel Configuration"}),"\n",(0,n.jsx)(t.h3,{id:"edit-the-device-tree-source",children:"Edit the Device Tree Source"}),"\n",(0,n.jsxs)(t.admonition,{type:"tip",children:[(0,n.jsxs)(t.p,{children:["Edit the link from ",(0,n.jsx)(t.code,{children:"github.com"})," to ",(0,n.jsx)(t.code,{children:"github.dev"})," to enter web editor mode."]}),(0,n.jsxs)(t.p,{children:["Use the shortcut ",(0,n.jsx)(t.code,{children:"Ctrl + H"})," to quickly replace text."]})]}),"\n",(0,n.jsx)(t.p,{children:"Access and modify the appropriate Device Tree Source file:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsxs)(t.a,{href:"https://github.com/renesas-rz/rz_linux-cip/blob/rzv2h-5.10-cip17/arch/arm64/boot/dts/renesas/r9a09g057h4-evk-ver1.dts",children:["Link to ",(0,n.jsx)(t.code,{children:"r9a09g057h4-evk-ver1.dts"})," file"]})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"replace",src:i(5472).A+"",width:"2560",height:"1540"})}),"\n",(0,n.jsx)(t.p,{children:"Make the following changes:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Replace any instance of ",(0,n.jsx)(t.code,{children:"ov5645"})," with ",(0,n.jsx)(t.code,{children:"ov5640"})," to switch the camera sensor."]}),"\n",(0,n.jsxs)(t.li,{children:["Update ",(0,n.jsx)(t.code,{children:"enable_gpios"})," from ",(0,n.jsx)(t.code,{children:"GPIO_ACTIVE_HIGH"})," to ",(0,n.jsx)(t.code,{children:"GPIO_ACTIVE_LOW"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"update-the-kernel-configuration",children:"Update the Kernel Configuration"}),"\n",(0,n.jsxs)(t.p,{children:["Edit the ",(0,n.jsx)(t.code,{children:"defconfig"})," file to enable the OV5640 driver:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsxs)(t.a,{href:"https://github.com/renesas-rz/rz_linux-cip/blob/rzv2h-5.10-cip17/arch/arm64/configs/defconfig",children:["Link to ",(0,n.jsx)(t.code,{children:"defconfig"})," file"]})}),"\n",(0,n.jsx)(t.p,{children:"Add the following line:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"CONFIG_VIDEO_OV5640=y\n"})}),"\n",(0,n.jsx)(t.h2,{id:"step-2-create-and-export-the-patch",children:"Step 2: Create and Export the Patch"}),"\n",(0,n.jsx)(t.p,{children:"Stage the modified files."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"stage",src:i(9673).A+"",width:"449",height:"518"})}),"\n",(0,n.jsxs)(t.p,{children:["Export the changes. A ",(0,n.jsx)(t.code,{children:"diff"})," file will be generated."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"export",src:i(1490).A+"",width:"452",height:"506"})}),"\n",(0,n.jsxs)(t.p,{children:["As there are two files that have been edited, there will be two ",(0,n.jsx)(t.code,{children:"diff"})," files. Merge them together into one single file by using any text editor of your preference. Save and name the file as ",(0,n.jsx)(t.code,{children:"0001-add_ov5640.patch"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"step-3-integrate-patch-file-into-build",children:"Step 3: Integrate Patch File Into Build"}),"\n",(0,n.jsx)(t.p,{children:"Move the patch file to this directory:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"~/rzv2h/src_setup/yocto/meta-rz-features/meta-rz-graphics/recipes-kernel/linux/files"})}),"\n",(0,n.jsxs)(t.p,{children:["Edit ",(0,n.jsx)(t.code,{children:".bbappend"})," file:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:'FILESEXTRAPATHS_prepend := "${THISDIR}/files:"\r\n\r\nSRC_URI_append_rzg2l = " \\\r\n        file://0002-Workaround-GPU-driver-remove-power-domains-of-GPU-no.patch \\\r\n"\r\nSRC_URI_append_rzv2l = " \\\r\n        file://0002-Workaround-GPU-driver-remove-power-domains-v2l.patch \\\r\n"\r\n\r\nSRC_URI_append_rzv2h = " \\\r\n        file://0001-add_ov5640.patch\xa0\\\r\n"\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Enter into the directory ",(0,n.jsx)(t.code,{children:"~/rzv2h/src_setup/yocto/build"}),". Then, start the build by running:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"TEMPLATECONF=${PWD}/meta-renesas/meta-rzv2h/docs/template/conf/ source poky/oe-init-build-env\r\n\r\nMACHINE=rzv2h-evk-ver1 bitbake core-image-weston\n"})}),"\n",(0,n.jsx)(t.h2,{id:"step-4-deploy-the-image-and-verify-camera-registration",children:"Step 4: Deploy the Image and Verify Camera Registration"}),"\n",(0,n.jsxs)(t.p,{children:["Burn the image named ",(0,n.jsx)(t.code,{children:"core-image-weston-rzv2h-evk-ver1.wic.gz"})," into an SD card. You may refer to ",(0,n.jsx)(t.strong,{children:"Step 8"})," of ",(0,n.jsx)(t.a,{href:"/tianhom/docs/my-tutorials/mcut-tutorials/week-2/2-2",children:"2-2"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"Use the following command to inspect media device nodes:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{children:"media-ctl /dev/media0 -p\n"})}),"\n",(0,n.jsx)(t.p,{children:"Confirm that the OV5640 camera is detected and registered correctly by the CRU (Camera Receiver Unit)."}),"\n",(0,n.jsx)(t.h2,{id:"step-5-configure-camera-preview-script",children:"Step 5: Configure Camera Preview Script"}),"\n",(0,n.jsx)(t.p,{children:"Open the preview.sh script."}),"\n",(0,n.jsx)(t.p,{children:"Modify its contents based on the media-ctl output to correctly map the camera and video device nodes."}),"\n",(0,n.jsx)(t.p,{children:"Run the script to start the camera preview and verify functionality."}),"\n",(0,n.jsx)(t.hr,{})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},9673:(e,t,i)=>{i.d(t,{A:()=>r});const r=i.p+"assets/images/E-2-1-0855a7976a98c89b89067c7829eb819c.png"}}]);